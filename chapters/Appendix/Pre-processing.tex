\chapter{Pre-processing}
\chaptermark{Pre-processing}
\label{app:pre-processing}
\graphicspath{{./chapters/Appendix/figs/}}

%Through out this thesis work we have used several datasets, sometime they consist of floorplans with different variation, sometime isolated graphical objects or historical handwritten documents. Some of the datasets are generated by us to perform some specific experimentations. In this chapter we give a description on all of them. And also when they are created by us we explain a brief methodology, motivation for the creation. The rest of this chapter is divided into nine sections, each of which is dedicated for each of the datasets.

Through out this thesis work we have used several pre-processing methods to extract image content.
The typical pre-processing task are noise removal, segmentation, enhancement, perspective correction, page curl removal, skew correction (text) and skeletonization.
In this appendix we detail some of the noise removal and segmentation methods which are related to comic book image analysis.


% Here we briefly detail the most used pre-processing and feature extraction methods related to document image analysis and comics design process.

% \paragraph{Pre-processing} % (fold)
% \label{par:pre_processing}
% Stroke-based images such as comics can be pre-processes is order to extract all the strokes for further analysis.
% Several method from the literature exist, 

\section{Noise removal} % (fold)
\label{sub:ap:noise_removal}
The image noise (unwanted signal) is the presence of parasite information in addition to the random details of the scene being shot digitally.
It is particularly visible in the low light areas where the signal/noise ratio is low, but also in the flat parts such as a blue sky.
It results in the loss of sharpness in the detailed regions.

\subsection{Salt and pepper} % (fold)
\label{sub:salt_and_paper}
TODO?
% subsection salt_and_paper (end)

\subsection{Quantization} % (fold)
\label{sub:quantization}
TODO?
% subsection dithering (end)

% subsection noise_removal (end)



\section{Segmentation} % (fold)
\label{sub:ap:segmentation}
Image segmentation is a division or separation of the image into regions of similar attribute.
The most basic attribute is image luminance amplitude for monochrome image or colour components for a colour image.
Image edge and texture are also useful attributes for segmentation~\cite{Pratt2007Digital}.

\subsection{Region-growing} % (fold)
\label{sub:ap:region_growing}
Region-growing methods are region-based segmentation algorithm that mainly rely on the assumption that the neighbouring pixels within one region have similar values.
The common procedure is to compare one pixel with its neighbours.
If a similarity criterion is satisfied, the pixel can be set belong to the cluster as one or more of its neighbours.
The selection of the similarity criterion is significant and the results are influenced by noise in all instances\footnote{\url{http://en.wikipedia.org/wiki/Image_segmentation\#Region-growing_methods}}.

One of the most famous region-growing segmentation is the seeded region-growing method~\cite{adams1994seeded,mehnert1997improved}.
This approach examines neighbouring pixels of initial seed points and determines whether the pixel neighbours should be added to the region and so on.
The result of the method highly rely on the selection of the seed points.
From the seed points, we grow a 4 or 8-connected neighbourhood for the pixels adjacent relationship.
Different parameters can be added, such as the minimum area threshold that will define the minimal region area returned by the algorithm.
The similarity measure is the criterion which should be verified to accept a neighbouring pixel in the current region~\cite{Gonzalez1992Digital}.
The segmentation by watershed, developed with mathematical morphology, belong to this category as well.

% subsection region_based (end)

\subsection{Split and merge} % (fold)
\label{sub:split_and_merge}
Split-and-merge segmentation is a region-based segmentation based on a quadtree split of the image.
This method starts from the whole image (root of the tree) and if it is non-uniform (not homogeneous pixel repartition), then it is split into four son-squares (the splitting process), and so on so forth.
Conversely, if four sub-squares are homogeneous, they can be merged as several connected components (the merging process).
The node in the tree is a squared or set of squared regions.
This process continues recursively until no further splits or merges are possible~\cite{Kelkar2008Improved,horowitz1976picture}.

% subsection split_and_merge (end)

\subsection{Contour-based} % (fold)
\label{sub:ap:contour_based}
This approach wants to take advantage of the fact that there is a detectable transition between two related areas.
The oldest methods use edge detector such as the well know Canny filter, to highlight the pixels that appear to belong to a contour~\cite{canny1986computational}.
The reconstruction of closed contours is often difficult.
See Section~\ref{sec:ap:connected_component_labelling} for closed contour extraction.

Irregular and partial contour segmentation have been studied as well, using deformable models that are more permissive.
The most famous model have been proposed by Kass, it is called the active contour model or snake~\cite{Kass1988}.
A curve $\mathbf{v}(s)=[x(s),y(s)], s \in [0,1]$ is initialized in the region of the contour to detect and it moves through the spatial domain of an image to minimize the energy function (Equation~\ref{eq:se:energy1}) until perfectly fitting the image region.

\begin{equation}\label{eq:se:energy1}
  E = \int_0^1 \! \frac{1}{2} \left( \alpha \left|\mathbf{v}'(s) \right|^2 + \beta \left| \mathbf{v}''(s) \right|^2 \right) + E_{ext}(\mathbf{v}(s))ds\\
\end{equation}
where $\alpha$ and $\beta$ are weighting parameters that respectively control the snake's tension and rigidity, and $\mathbf{v}'$ and $\mathbf{v}''$ denote the first and second derivatives of $\mathbf{v}(s)$ with respect to $s$. This functional energy is also called $E_{int}$ for internal energy.
The external energy function $E_{ext}$ is computed from the image so that it takes on its smaller values at the features of interest, such as boundaries~\cite{Xu1998}.
%It was initially designed to localize nearby edges accurately by using both internal and external energies (see eq.~\ref{eq:se:energy1}). 
%The external energy function $E_{ext}$ aim to attract the snake to the feature of interest (e.g. line, edge, corner), it is the image force. 
One of the proposed energy functions by Kass~\cite{Kass1988} is equation~\ref{eq:se:edge} which attracts the contour to edges with large image gradients. 
\begin{equation}\label{eq:se:edge}
  E_{ext} = -|\nabla \mathbf{I}(x,y)^2|
\end{equation}

% subsection contour_based (end)

\subsection{Bi-level grey-scale thresholding} % (fold)
\label{sub:ap:bi_threshold}
A survey counts forty thresholding methods from histogram shape-based to spatial and local methods~\cite{sezgin2004survey}.
 
The most famous method is Otsu's method~\cite{otsu79} that assumes that a single channel image is dividable in two main cluster: the background and the foreground.
It calculates the optimum threshold separating the two cluster so that their intra-cluster variance is minimal in the image histogram.
Applying the Otsu's threshold selection to a grey-level image returns a binary image where foreground pixel are separated from background pixels.

The major problem with thresholding is that it considers only the intensity, not any relationships between the pixels (no spatial information).
Another problem with global thresholding is that changes in illumination across the scene may cause some parts to be brighter and some parts darker in ways that have nothing to do with the foreground and background objects (e.g. light and shadow variation).
Those issues have been partially handled by local approaches determining thresholds locally instead of the whole image.


% subsection threshold_based (end)

\subsection{Multi-level colour thresholding} % (fold)
\label{sub:ap:muli_threshold}

A first approach for multi-level thresholding is to apply bi-level thresholding to each of the colour layer in one or several colour space and merge them to give a single output.
Two more natural approach are divisive clustering and agglomerative clustering.
In divisive clustering, the entire image is regarded as a cluster, and then clusters are recursively split to yield a good clustering.
In agglomerative clustering, each pixel or region is regarded as a cluster and clusters are recursively merged to yield a good clustering.
There are two major issues in thinking about clustering:
\begin{itemize}
	\item What is a good inter-cluster distance?
	\item How many cluster are there?
\end{itemize}
Addressing both issue automatically still an open issue if we don't have strong knowledge about the image content.
Common clustering algorithm like $k$-means partitions the data (pixels values) into $k$ sets by minimizing the within-cluster sum of squares~\cite{PonceForsyth2012}.
It does not require any probabilistic reasoning or modelling~\cite{Bishop2006PRM}.
K-means clustering aims to partition $(x_1, x_2, ...,x_n)$ observations into $k$ clusters ($k <= n$) $S=\{S_1, S_2, ..., S_k\}$ in which each observation belongs to the cluster with the nearest mean.
This optimisation problem is formulated as formula~\ref{eq:se:k-means}.

\begin{equation}
	arg min \sum\limits_{i=1}^k \sum\limits_{n_j \in S_i} ||x_j - \mu_i||^2
	\label{eq:se:k-means}
\end{equation}
where $\mu_i$ is the mean of points in the cluster $S_i$.


%Mean shift

%Graph cut


% section connected_component_labelling (end)

% subsection clustering (end)

% subsection segmentation (end)






% \section{L'Esposalles dataset}
% \label{sec:datasets:lesposalles}
% This dataset is a collection of pages compiled from marriage licence books conserved at the archives of Barcelona cathedral~\cite{Romero2013}\footnote{\url{http://dag.cvc.uab.es/the-esposalles-database}}. The original marriage register is composed of 291 books/volumes with information of 600,000 marriages celebrated in 250 parishes in between 1451 and 1905. The dataset has three partitions: (1) the indices, (2) the marriage record and (3) the segmented lines. At present the indices part of this dataset contains only the indices of two volumes and the marriage record part is taken from a single volume. Some examples of indices and register pages are visible in Figure~\ref{fig:datasets:lesposalles}.